<link rel="import" href="../components/polymer/polymer.html">
<link rel="import" href="../questions-service/questions-service.html">
<link rel="import" href="../components/paper-button/paper-button.html">
<link rel="import" href="../components/paper-ripple/paper-ripple.html">
<link rel="import" href="../components/core-selector/core-selector.html">
<link rel="import" href="../components/paper-toast/custom-paper-toast.html">
<link rel="import" href="../components/paper-toast/paper-toast.html">
<link rel="import" href="../components/paper-shadow/paper-shadow.html">
<link rel="import" href="status-bar.html">
<link rel="import" href="../components/paper-button/paper-button.html">
<link rel="import" href="../components/core-ajax/core-ajax.html">
  <polymer-element name="core-notifications" attributes="nqno">
		  <template>
					<style>    
								.body{
										background: #00FF80;
								}
								
								:host {
										position: absolute;
										width: 100%;
										height: 100%;
										box-sizing: border-box;
								}
								
								.item.core-selected {
										background: #00FF80;
							   }
							  
							  .item{
										height: 40px;
										line-height: 40px;
										padding: 0px 20px;
										border-bottom-width: 1px;
										border-bottom-style: solid;
										border-bottom-color: rgb(204, 204, 204);
								}
								
								#section {
										box-sizing: border-box;
										width: 750px;
										height: 250px;
										left: 350px;
										 top: 70px;
										position: absolute;
								}

								#div {
										box-sizing: border-box;
										position: left;
										height: 440px;
										background-color: #A9E2F3;
										padding: 24px;
										 font-size: 32px;
								}

								#inline{
										display: inline;
								}
								
								#paper_fab{
										margin-left:90%;
								}
								
								#paper_fab1{
								
								}
								
								#que{
										height:100px;
								}
								
								#answers{
										 font-size: 32px;
										 background-color:#BCF5A9;
								}
								
								#my{
										width:450px;
								}
								
								#section {
										box-sizing: border-box;
										position: absolute;	
								}
								
								paper-toast {
										top: 500px;
										left: 700px;
										font-size:30px;
										color:green;

								}
								
								custom-paper-toast {
										top: 100px;
										left:400px;
										height: 400px;
										width:400px;
										font-size:30px;
								}

								#toast123{
										align:center;
										background-color:black;
										color:white;
										font-size:20px;
								}
								#redoToast{
										align:center;
										left:20px;
										width:200px;
										background-color:black;
										color:white;
										font-size:20px;
										
								}
								
								#toast1{
										background-color:green;
										color:white;
										font-size:30px;
										height:500px;
										width:400px;
								}
								
								#toast2{
										background-color:#FFFF00;
										color:black;
										font-size:30px;
										height:500px;
										width:400px;
								}
								
								#butn1{
										background-color:black;
										color:white;
										margin:0 auto;
										height:50px;
										width:50px;
										font-size:20px;
										display:none;
								}
								
								#g1{
										background-color:black;
										right:350px;
										position:left;
										color:white;
										margin:0 auto;
										height:50px;
										width:50px;
										font-size:20px;
								}
								
								paper-shadow #shadow-top {
										border-radius: inherit;
										border-top-left-radius: inherit;
										border-top-right-radius: inherit;
										border-bottom-right-radius: inherit;
										border-bottom-left-radius: inherit;
										pointer-events: none;
								}
								
								html .paper-shadow-top-z-5 {
										box-shadow: 0 40px 77px 0 rgba(0, 0, 0, 0.22);
								}
								
								#di1 {	
										display:none;
										position:absolute;
										float:left;
								}
								
								#di2 {
										display:none;
										position:absolute;
										float:left;
								}
								
								#di3 {
										display:none;
										position:absolute;
								}
								
								#di4 {
										display:none;
										position:absolute;
								}
								#quizsection {
									
										position:absolute;
								}
			                    #finishsection {
									box-sizing: border-box;
									background-color:grey;
									width: 1000px;
									height: 550px;
									left: 150px;
									top: 70px;
									position: absolute;						
								}
							    #score {
									box-sizing: border-box;
									background-color: lightgreen;
									width: 300px;
									height: 250px;
									left: 200px;
									top: 25px;
									position: absolute;						
								}
								#leaderboard {
									box-sizing: border-box;
									background-color: lightblue;
									width: 300px;
									height: 500px;
									left: 600px;
									top: 25px;
									position: absolute;						
								}
								#di5 {
			 						align:center;
			 						text-align: center;
									color:darkgreen;
									font-size:20px;
								}
								#di6 {
			 						align:right;
			 						text-align: center;
									color:darkblue;
									font-size:20px;
								}
								#butn2{
									background-color:pink;
									align:right;
									color:black;
									margin:0 auto;
									height:50px;
									width:150px;
									font-size:20px;
									display:bold;
							    }
					    		#butn3{
									background-color:pink;
									color:black;
									margin:0 auto;
									height:50px;
									width:50px;
									font-size:20px;
									display:bold;
								}
								#butn4{
									background-color:pink;
									color:black;
									margin:0 auto;
									height:50px;
									width:50px;
									font-size:20px;
									display:bold;
								}
								#finishsection{
									display:none;
								}

					</style>
						<paper-fab icon="shopping-cart" id="paper_fab" cross-fade-delayed on-click="{{display}}"></paper-fab>
					 <questions-service id="service" questions="{{questions}}">
					</questions-service>
				<section id="quizsection" class="paper-shadow-top-z-5" layout vertical>
						
					<status-bar id="my" class="paper-shadow-top-z-5" score="0" qno="1" qlength={{questions.length}} lives=4></status-bar>
					
				
					
					<section id="section" class="paper-shadow-top-z-5" layout vertical>
							<custom-paper-toast id="toast123" color="green" text="Yo" role="status" touch-action="none" tabindex="-1" class="core-transition core-transition-center" style="position: fixed; outline: none; display: none;"><paper-fab icon="redo" id="paper_fab1" cross-fade-delayed on-click="{{redoTest}}"></paper-fab><paper-fab icon="arrow-forward" id="paper_fab1" cross-fade-delayed on-click="{{finish}}"></paper-fab></custom-paper-toast>
							<paper-toast id="toast1" color="red" text="Wrong answer" role="status" touch-action="none" tabindex="-1" class="core-transition core-transition-bottom" style="position: fixed; outline: none; display: none;"></paper-toast>	
							<paper-toast id="toast2" color="red" text="Wrong answer" role="status" touch-action="none" tabindex="-1" class="core-transition core-transition-bottom" style="position: fixed; outline: none; display: none;"></paper-toast>	
							<paper-toast id="toast2" color="red" text="Wrong answer" role="status" touch-action="none" tabindex="-1" class="core-transition core-transition-bottom" style="position: fixed; outline: none; display: none;"></paper-toast>		
							<custom-paper-toast id="redoToast" color="green" role="status" touch-action="none" tabindex="-1" class="core-transition core-transition-center" style="position: fixed; outline: none; display: none;"><paper-button raised id="redo" on-click="{{redoTest}}">Redo</paper-button></custom-paper-toast>
									<div id="div" hero>
												<span id="span">Question</span>
												<div id="que">
														<blockquote > {{questions[nqno].question}} </blockquote>
												</div>
								 
												<paper-fab icon="av:play-arrow" id="paper_fab" cross-fade-delayed on-click="{{updateModel}}"></paper-fab>
								   </div>
								
									<section id="section1" hero flex>
											<div id="answers">
														<span id="span1">Choose Answers</span>
																<br>
																<br>
														<core-selector id="ans"  selectedItem="{{input}}">
																	<div class="item" id="ch1">{{questions[nqno].ch1}} <paper-fab id="di1" mini icon="done" ></paper-fab></div>
															
																	<div class="item" id="ch2">{{questions[nqno].ch2}}<paper-fab id="di2" mini icon="close"></paper-fab></div>
			

																	<div class="item" id="ch3">{{questions[nqno].ch3}}<paper-fab id="di3" mini icon="done"></paper-fab></div>
															
																	<div class="item" id="ch4">{{questions[nqno].ch4}}<paper-fab id="di4" mini icon="done"></paper-fab></div>
														</core-selector>
														<paper-button raised id="butn1" on-click="{{showhint}}">Hint</paper-button>
											</div>
									</section>
							
					</section>
				</section>

				<section id="finishsection" hero flex>
					<section id="score">
						<div id="di5">Score</div>
					</section>
					<section id="leaderboard">
						<div id="di6">Leader Board</div>
					</section>
					<div id="di7">
					<paper-button raised id="butn2" on-click="{{show}}">NextLevel</paper-button>
					<br>
					<br>
					<paper-button raised id="butn3" on-click="{{redoTest}}">Redo</paper-button>
					<br>
					<br>
					<paper-button raised id="butn4" on-click="{{show}}">Review</paper-button>
				</div>
				</section>
		  </template>
				<script>
						var i=0;		var string;
						var score=0;
						var delay=3000;
						var a=0; var hint=0;
						var delay1=8000;
						var life=4;
						var tstart;
						var tend;
						// person object creation
						var person = {
								question:[],
								ttime:0,
								score:0,
						};
						// question object creation
						person.question.push({
												qs:"",
												ans:"",
												option:false,
												time:0,
												hint:false,
												score:0
										});
						Polymer('core-notifications', {
								publish: 
								{
									nqno :'',
									
								},
								finish:function() {
									this.$.quizsection.style.display="none";  
									this.$.finishsection.style.display="inline";
								},
								created: function() {
										this.questions=[];
										this.nqno=0;
										this.chance=0;
										this.nqno=0;
										this.async(function() {
												this.$.butn1.style.display="block";
										},null,delay1);
										
										tstart=new Date().getTime();
								},
								redoTest: function(){
										this.$.paper_fab.style.display="block";
										this.nqno=0;										
										this.chance=0;
										i=0;
										life=4;
										a=0;
										score=0;
										hint=0;
										this.$.my.lives=life;
										this.$.my.qno=0;
										this.$.my.a=0;
										this.$.di1.style.display='none';
										this.$.di2.style.display='none';
										this.$.di3.style.display='none';
										this.$.di4.style.display='none';
										this.$.di1.style.backgroundColor='red';
										this.$.di2.style.backgroundColor='red';
										this.$.di3.style.backgroundColor='red';
										this.$.di4.style.backgroundColor='red';
								},
								showhint: function() {
										person.question[this.nqno].hint=true;
										var v="";
										if(this.questions[this.nqno].hint=="") {
												this.$.toast2.text="There is no hint for this question";
										} 
										else 
												this.$.toast2.text="Hint : "+this.questions[this.nqno].hint;
												this.$.toast2.show();
												this.$.butn1.style.display="none";
								}, 
					
								display: function() {
									for (i = 0; i < 7; i++) {
									string =string + person.question[i].qs+" score "+person.question[i].score+"  hint "+person.question[i].hint+" time "+ person.question[i].time;
								}
								alert(string);
								},
								updateModel: function() {
									if(this.nqno==0) {
										for(var k=0;k<this.questions.length;k++) {
											if(k!=0) {
												person.question.push({
													qs:this.questions[k].question,
													ans:this.questions[k].ans,
													option:false,
													time:0,
													hint:false,
													score:0
												});
											} else {
												person.question[0].qs=this.questions[k].question;
												person.question[0].ans=this.questions[k].ans;
											}
										}
									}
									if(i<this.questions.length) {
												//alert(i+1);
												//question[i].qs=this.questions[0].question;
												//alert(question[i].qs);
												a=(((this.nqno+1)/this.questions.length)*100);
												var x=this.input.innerHTML; var l,y=0,l1=0,start=0;
												for(l=0;l<x.length;l++){
															if(x.charAt(l)=="<"){
																	break;
															} y++;
												}  
												for(l1=0;l1<x.length;l1++){
															if(x.charAt(l1)=="=" ) {
																		l1++;
																		start=l1+1; 
																		break;
															} 
												}
												var r=x.substring(start, start+3);
												x=x.substring(0, y);
												//console.log(x); 
												var flag1=0;
												// if answer is correct
												if((x==this.questions[this.nqno].ans)){
															this.$.paper_fab.style.display="none";
															tend=new Date().getTime();
															person.question[this.nqno].time=(tend-tstart)/1000;
															//alert(person.question[this.nqno].time+"   "+tend+"    " +tstart);
															flag1++;
															if(r=="di1") {
																		this.$.di1.style.display='inline';
																		this.$.di1.icon='done';
																		this.$.di1.style.backgroundColor='green';
															}
															else if(r=="di2"){
																		this.$.di2.style.display='inline';
																		this.$.di2.icon='done';
																		this.$.di2.style.backgroundColor='green';
															}
															else if(r=="di3"){
																		this.$.di3.style.display='inline';
																		this.$.di3.icon='done';
																		this.$.di3.style.backgroundColor='green';
															}
															else if(r=="di4"){
																		this.$.di4.style.display='inline';
																		this.$.di4.icon='done';
																		this.$.di4.style.backgroundColor='green';
															}
															var audio = new Audio('rightvoice.ogg');
															audio.play();
															person.question[this.nqno].option=true;
															// first time wrong then score =50 
															if(this.chance==1) {
																		person.question[this.nqno].score=50;
																		score=score+50;
																		//question[i].s=score;
																	//	alert(i);
																		//alert(question[i].s);
															} 
															
															// first time correct then score =100
															else {
																	person.question[this.nqno].score=100;
																		score=score+100;
																			//question[i].s=score;
																			//alert(i);
																			//alert(question[i].s);
															}
															this.$.toast1.text="Correct answer. Your score is "+score;
															this.$.butn1.style.display="none";
															// dynamic change of color	for selector
															this.$.toast1.show();
															
															// finding last question
															if(i!=this.questions.length-1){
																		// creating delay for next question
																		this.async(function() {
																					this.$.di1.style.backgroundColor='red';
																					this.$.di2.style.backgroundColor='red';
																					this.$.di3.style.backgroundColor='red';
																					this.$.di4.style.backgroundColor='red';
																					this.nqno++;
																					//this.nqno = this.nqno + 1;
																					//this.questions[0]=this.questions[this.nqno];
																					this.$.my.qno=i+1;this.$.my.score=score;this.$.my.a=a;
																					this.$.paper_fab.style.display="block";
																		},null,delay);
																		this.async(function() {
																			this.$.butn1.style.display="block";
																		},null,delay+delay1);
															}
															
															// showing final score at the end of level
															else{
																		for(var k=0;k<this.questions.length;k++) {
																					person.score+=person.question[k].score;
																		}
																		this.$.my.score=score;this.$.my.a=a;
																		this.$.toast123.text=person.score+" Your Final score is "+score;
																		this.$.toast123.show();
															}
															i++;
															this.chance=0;
												} 
												
												// if answer is not  correct
												else {	
															if(r=="di1"){
																		this.$.di1.icon='close';
																		this.$.di1.style.display='inline';
											
															}
															else if(r=="di2"){
																		this.$.di2.icon='close';
																		this.$.di2.style.display='inline';
																		//this.$.di2.icon='done';
															}
															else if(r=="di3"){
																		this.$.di3.icon='close';
																		this.$.di3.style.display='inline';
																		//this.$.di3.icon='done';
															}
															else if(r=="di4"){
																		this.$.di4.icon='close';
																		this.$.di4.style.display='inline';
																		//this.$.di4.icon='done';
															}
															this.chance=this.chance+1;
															var flag=0;
															life=life-1;
															if(life==0)
															{
																this.$.paper_fab.style.display="none";
																this.$.redoToast.text="You lost all your lives. Start from the begining.";
																this.$.redoToast.show();
															}
															if(this.chance==1) // wrong answer for first time
															{
																this.$.my.lives=life;
																var audio = new Audio('hint.ogg');
																		audio.play();
																		this.$.toast2.text="Wrong Answer.";
																		this.$.toast2.show();
																		this.$.butn1.style.display="block";
															}
															else if(this.chance==2) // wrong for the second time 
															{
																	flag++;																	
																	if(this.questions[this.nqno].ans1=="ch1"){
																		this.$.di1.icon='done';
																		this.$.di1.style.backgroundColor='green';																		
																		this.$.di1.style.display='inline';}
																	else if(this.questions[this.nqno].ans1=="ch2"){
																		this.$.di2.icon='done';
																		this.$.di2.style.backgroundColor='green';
																		this.$.di2.style.display='inline';}
																	else if(this.questions[this.nqno].ans1=="ch3"){
																		this.$.di3.icon='done';
																		this.$.di3.style.backgroundColor='green';
																		this.$.di3.style.display='inline';}
																	else if(this.questions[this.nqno].ans1=="ch4"){
																		this.$.di4.style.backgroundColor='green';
																		this.$.di4.icon='done';
																		this.$.di4.style.display='inline';}
																	var audio = new Audio('voicebuzzer.ogg');
																		audio.play();
																		this.$.toast2.text="Wrong Answer. The correct answer is "+this.questions[this.nqno].ans;
																		this.$.paper_fab.style.display="none";
																		this.$.butn1.style.display="none";
																		this.$.toast2.show();
																		
																		// finding last question
																		if((i!=this.questions.length-1)) {
																			if(life!=0) {
																					// delay for next question
																					this.async(function(){				
																								this.nqno++;
																								//this.nqno = this.nqno + 1;
																								//this.questions[0]=this.questions[this.nqno];
																								this.$.my.qno=i+1;this.$.my.score=score;this.$.my.a=a;
																								this.$.paper_fab.style.display="block";
																								this.$.my.lives=life;
																								this.$.di1.style.backgroundColor='red';
																								this.$.di2.style.backgroundColor='red';
																								this.$.di3.style.backgroundColor='red';
																									this.$.di4.style.backgroundColor='red';
																					},null,delay);
																					this.async(function() {
																						this.$.butn1.style.display="block";
																					},null,delay+delay1);
																			}
																		}
																		
																		// showing score at the end of level
																		else{
																				var s="";
																				for(var k=0;k<this.questions.length;k++) {
																					person.score+=person.question[k].score;
																				}
																					this.$.my.score=score;this.$.my.a=a;
																					this.$.toast123.text=person.score+"Your Final score is "+score;
																					this.$.toast123.show();
																		}
																		this.chance=0;
																		i++;
															}
													}	
									}	          
												this.async(function() {				
															if(flag1!=0&&life!=0){
																		flag1=0;
																		this.$.di1.style.display='none';
																		this.$.di2.style.display='none';
																		this.$.di3.style.display='none';
																		this.$.di4.style.display='none';
																		this.$.butn1.style.display="none";
															}
															if(flag!=0&&life!=0){
																		flag=0;
																		this.$.di1.style.display='none';
																		this.$.di2.style.display='none';
																		this.$.di3.style.display='none';
																		this.$.di4.style.display='none';
																		this.$.butn1.style.display="none";
															}

												},null,delay);
												tstart=new Date().getTime();
								}  
						});
						function loadq() {
							var audio = new Audio('welcome.ogg');
							audio.play();	
						}
						window.onload=loadq;
				</script>
  </polymer-element>